<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ×¨×™×§×•×œ×™× ×œ×¨×›×‘ | ××©×¨×“ ×”×ª×—×‘×•×¨×”</title>
    
    <!-- Google Fonts: Rubik -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS Framework -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- CSV Parser Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        body { font-family: 'Rubik', sans-serif; }
        
        /* --- Israeli License Plate Component --- */
        .il-plate-container {
            background-color: #FFCC00; /* The Standard Yellow */
            border: 2px solid #333;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            max-width: 320px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            height: 70px;
            transition: transform 0.2s;
        }
        
        .il-plate-container:focus-within {
            transform: scale(1.02);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }

        .il-blue-strip {
            background-color: #003399;
            width: 45px;
            height: 100%;
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 11px;
            font-weight: bold;
            position: absolute;
            left: 0; 
            top: 0;
            z-index: 10;
        }

        .il-input {
            background: transparent;
            border: none;
            width: 100%;
            height: 100%;
            text-align: center;
            font-size: 2.5rem;
            font-weight: 900;
            color: #333;
            letter-spacing: 4px;
            outline: none;
            padding-left: 50px;
            font-family: 'Rubik', sans-serif;
        }

        /* Hide spinner in input numbers */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

        /* Loading Spinner */
        .loader {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid #fff;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-left: 8px;
            display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Animation for results */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- HERO SECTION -->
    <header class="bg-white shadow-sm pt-12 pb-16 px-4 text-center relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600"></div>
        
        <h1 class="text-4xl md:text-5xl font-black text-slate-900 mb-4 tracking-tight">
            ×”×× ×”×¨×›×‘ ×©×œ×š ×‘×˜×•×—?
        </h1>
        <p class="text-xl text-slate-600 mb-10 max-w-2xl mx-auto font-light">
            ×‘×“×™×§×” ××”×™×¨×” ×‘×××’×¨ ××©×¨×“ ×”×ª×—×‘×•×¨×” ×œ××™×ª×•×¨ ×§×¨×™××•×ª ×©×™×¨×•×ª (Recall) ×¤×ª×•×—×•×ª.
        </p>

        <!-- Input Area -->
        <div class="mb-8">
            <div class="il-plate-container">
                <div class="il-blue-strip">
                    <span>IL</span>
                    <div class="w-5 h-3 bg-white rounded-[1px] mt-1 opacity-90"></div>
                    <span>×™×©×¨××œ</span>
                </div>
                <input type="text" inputmode="numeric" pattern="[0-9]*" id="plateInput" class="il-input" placeholder="12345678" maxlength="8">
            </div>
            <p class="text-sm text-gray-400 mt-2">×”×–×Ÿ ××¡×¤×¨ ×¨×›×‘ (7 ××• 8 ×¡×¤×¨×•×ª)</p>
        </div>

        <button id="searchBtn" onclick="checkCar()" class="bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white font-bold py-3 px-10 rounded-full shadow-lg shadow-blue-500/30 transition-all transform hover:-translate-y-1 text-lg flex items-center justify-center mx-auto">
            ×‘×“×™×§×ª ×¨×›×‘ 
        </button>

        <!-- RESULT AREA -->
        <div id="resultArea" class="mt-10 max-w-3xl mx-auto hidden transition-all duration-500 ease-in-out">
            <!-- Content injected via JS -->
        </div>
    </header>

    <!-- INFO / GRAPHS SECTION -->
    <main class="max-w-5xl mx-auto px-4 py-12 space-y-20">
        <div class="text-center">
            <h2 class="text-3xl font-bold text-slate-900">× ×ª×•× ×™× ××”×©×˜×—</h2>
            <div class="w-16 h-1.5 bg-blue-600 mx-auto mt-4 rounded-full"></div>
            <p class="mt-4 text-lg text-slate-600 max-w-2xl mx-auto">
                ××ª×•×š ×¢×©×¨×•×ª ××œ×¤×™ ×¨×©×•××•×ª, ×× ×• ××¦×™×’×™× ××ª ×”× ×ª×•× ×™× ×”×¢×“×›× ×™×™× ×‘×™×•×ª×¨ ×¢×œ ×ª×§×œ×•×ª ×‘×˜×™×—×•×ª ×‘×™×©×¨××œ.
            </p>
        </div>

        <div class="grid md:grid-cols-2 gap-8">
            <!-- Placeholder Graph 1 -->
            <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100">
                <div class="h-64 bg-slate-100 rounded-xl flex items-center justify-center mb-4 text-slate-400 relative overflow-hidden">
                    <!-- If you have images, uncomment the line below and remove the span -->
                    <!-- <img src="assets/graph1.png" class="object-contain h-full w-full"> -->
                    <span class="text-6xl opacity-20">ğŸ“Š</span>
                </div>
                <h3 class="text-xl font-bold text-slate-800 mb-2">×”×™×¦×¨× ×™× ×¢× ×”×›×™ ×”×¨×‘×” ×§×¨×™××•×ª</h3>
                <p class="text-slate-600 text-sm leading-relaxed">
                    ×”×’×¨×£ ××¦×™×’ ××ª ×”×ª×¤×œ×’×•×ª ×”×§×¨×™××•×ª ×”×¤×ª×•×—×•×ª ×œ×¤×™ ×™×¦×¨×Ÿ. (×›××Ÿ ×ª×•×›×œ ×œ×”×•×¡×™×£ ×ª××•× ×” ×©×œ ×”×’×¨×£ ×©×™×¦×¨×ª).
                </p>
            </div>

            <!-- Placeholder Graph 2 -->
            <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100">
                <div class="h-64 bg-slate-100 rounded-xl flex items-center justify-center mb-4 text-slate-400 relative overflow-hidden">
                     <!-- If you have images, uncomment the line below and remove the span -->
                    <!-- <img src="assets/graph2.png" class="object-contain h-full w-full"> -->
                    <span class="text-6xl opacity-20">ğŸ“‰</span>
                </div>
                <h3 class="text-xl font-bold text-slate-800 mb-2">×¡×•×’×™ ×ª×§×œ×•×ª × ×¤×•×¦×™×</h3>
                <p class="text-slate-600 text-sm leading-relaxed">
                    ×”×× ×”×‘×¢×™×” ×”×™× ×‘×›×¨×™×•×ª ×”××•×•×™×¨ ××• ×‘×× ×•×¢? × ×™×ª×•×— ×¡×•×’×™ ×”×ª×§×œ×•×ª ×”× ×¤×•×¦×™× ×‘×™×•×ª×¨ ×‘×™×©×¨××œ.
                </p>
            </div>
        </div>
    </main>

    <footer class="bg-slate-900 text-slate-400 text-center py-8 mt-12 border-t border-slate-800">
        <p class="text-sm">×”××™×“×¢ ××‘×•×¡×¡ ×¢×œ ×××’×¨ ×”××™×“×¢ ×”×××©×œ×ª×™ (Data.gov.il).</p>
        <p class="text-xs mt-2 opacity-50">×¤×•×ª×— ×›×©×™×¨×•×ª ×œ×¦×™×‘×•×¨. ××™×Ÿ ×œ×¨××•×ª ×‘××™×“×¢ ×–×” ×™×™×¢×•×¥ ××©×¤×˜×™ ××• ××§×¦×•×¢×™.</p>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // Cache to ensure we don't download files twice
        const dataCache = {};

        function checkCar() {
            const inputField = document.getElementById('plateInput');
            const resultDiv = document.getElementById('resultArea');
            const btn = document.getElementById('searchBtn');
            
            // 1. Clean Input (Remove spaces/dashes)
            const input = inputField.value.replace(/[^0-9]/g, '').trim(); 
            
            // Reset UI
            resultDiv.innerHTML = '';
            resultDiv.classList.add('hidden');

            // Basic Validation
            if(!input || input.length < 6) {
                alert('× × ×œ×”×–×™×Ÿ ××¡×¤×¨ ×¨×›×‘ ×ª×§×™×Ÿ (×œ×¤×—×•×ª 6 ×¡×¤×¨×•×ª)');
                return;
            }

            // UI Loading State
            const originalBtnText = btn.innerText;
            btn.innerHTML = '<div class="loader"></div> ×˜×•×¢×Ÿ...';
            btn.disabled = true;
            inputField.disabled = true;

            // 2. Determine File (Split strategy)
            const lastDigit = input.slice(-1);
            const fileName = `split_data/data_${lastDigit}.csv`;

            console.log(`Searching for: ${input} in file: ${fileName}`);

            // Function to restore button state
            const resetUI = () => {
                btn.innerText = "×‘×“×™×§×ª ×¨×›×‘";
                btn.disabled = false;
                inputField.disabled = false;
            };

            // 3. Process Logic
            const processData = (data) => {
                if (!data || data.length === 0) {
                    console.error("CSV File was empty");
                    alert("×©×’×™××” ×‘×§×¨×™××ª ×”× ×ª×•× ×™×");
                    resetUI();
                    return;
                }

                // --- SMART COLUMN DETECTION (Fixes "Invisible Character" bug) ---
                const firstRow = data[0];
                const keys = Object.keys(firstRow);
                
                // Find columns that *contain* the keywords (ignores BOM/encoding junk)
                const plateKey = keys.find(k => k.includes('MISPAR_RECHEV'));
                const recallTypeKey = keys.find(k => k.includes('SUG_RECALL')) || 'SUG_RECALL';
                const issueKey = keys.find(k => k.includes('TEUR_TAKALA')) || keys.find(k => k.includes('SUG_TAKALA')) || 'TEUR_TAKALA';
                const dateKey = keys.find(k => k.includes('TAARICH_PTICHA')) || 'TAARICH_PTICHA';

                if (!plateKey) {
                    console.error("Critical Error: Could not identify Plate Number column in:", keys);
                    alert("×©×’×™××” ×‘××‘× ×” ×”× ×ª×•× ×™×. × × ×œ×¤×ª×•×— F12 ×•×œ×‘×“×•×§ ×‘×§×•× ×¡×•×œ.");
                    resetUI();
                    return;
                }

                // Filter Data
                const foundVehicles = data.filter(row => {
                    // Convert to string and trim to be safe
                    const rowPlate = String(row[plateKey] || '').trim();
                    return rowPlate === input;
                });

                // Render
                renderResults(foundVehicles, input, { recallTypeKey, issueKey, dateKey });
                resetUI();
            };

            // 4. Check Cache or Fetch
            if (dataCache[lastDigit]) {
                console.log("Using cached data");
                processData(dataCache[lastDigit]);
            } else {
                Papa.parse(fileName, {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    // We remove 'encoding' parameter to let browser auto-detect, usually works best for UTF-8
                    complete: function(results) {
                        dataCache[lastDigit] = results.data;
                        processData(results.data);
                    },
                    error: function(err) {
                        console.error("Network/Parse Error:", err);
                        alert('×œ× × ×™×ª×Ÿ ×œ×˜×¢×•×Ÿ ××ª ×§×•×‘×¥ ×”× ×ª×•× ×™×. ×•×•×“× ×©×ª×™×§×™×™×ª split_data ×§×™×™××ª ×‘-GitHub.');
                        resetUI();
                    }
                });
            }
        }

        function renderResults(foundVehicles, input, colNames) {
            const resultDiv = document.getElementById('resultArea');
            resultDiv.classList.remove('hidden');

            if(foundVehicles.length > 0) {
                // --- BAD NEWS (Recall Found) ---
                let html = `
                    <div class="bg-red-50 border-2 border-red-100 rounded-2xl p-6 md:p-8 text-right shadow-xl animate-fade-in">
                        <div class="flex items-center mb-4 border-b border-red-100 pb-4">
                            <div class="bg-red-100 text-red-600 p-3 rounded-full text-2xl ml-4">âš ï¸</div>
                            <div>
                                <h3 class="font-black text-2xl text-red-800">× ××¦××• ×§×¨×™××•×ª ×©×™×¨×•×ª ×¤×ª×•×—×•×ª</h3>
                                <p class="text-red-600 text-sm">×¨×›×‘ ××¡×¤×¨: <span class="font-mono font-bold text-lg">${input}</span></p>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full text-right">
                                <thead class="text-xs text-red-500 uppercase bg-red-100/50 rounded">
                                    <tr>
                                        <th class="px-4 py-3 rounded-r">×¡×•×’ ×¨×™×§×•×œ</th>
                                        <th class="px-4 py-3">××”×•×ª ×”×ª×§×œ×”</th>
                                        <th class="px-4 py-3 rounded-l">×ª××¨×™×š</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-red-100">
                `;

                foundVehicles.forEach(v => {
                    html += `
                        <tr class="hover:bg-red-50 transition">
                            <td class="px-4 py-3 font-bold text-slate-700">${v[colNames.recallTypeKey] || '×›×œ×œ×™'}</td>
                            <td class="px-4 py-3 text-slate-600 text-sm">${v[colNames.issueKey] || '×œ×œ× ×¤×™×¨×•×˜'}</td>
                            <td class="px-4 py-3 text-slate-500 text-sm whitespace-nowrap">${v[colNames.dateKey] || '-'}</td>
                        </tr>
                    `;
                });

                html += `
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-6 bg-white p-4 rounded-xl border border-red-100 flex items-start gap-3">
                            <span class="text-xl">ğŸ“</span>
                            <p class="text-sm text-slate-600 leading-snug">
                                <strong>××” ×¢×•×©×™× ×¢×›×©×™×•?</strong><br>
                                ×—×•×‘×” ×œ×’×©×ª ×œ××•×¡×š ×”×™×‘×•××Ÿ ×œ×ª×™×§×•×Ÿ ×”×ª×§×œ×” (×”×ª×™×§×•×Ÿ ×‘×“×¨×š ×›×œ×œ ×œ×œ× ×¢×œ×•×ª). ×œ× × ×™×ª×Ÿ ×œ×¢×‘×•×¨ ×˜×¡×˜ ×©× ×ª×™ ×¢× ×¨×™×§×•×œ ×¤×ª×•×— ××¢×œ 6 ×—×•×“×©×™×.
                            </p>
                        </div>
                    </div>
                `;
                resultDiv.innerHTML = html;

            } else {
                // --- GOOD NEWS (No Recall) ---
                resultDiv.innerHTML = `
                    <div class="bg-emerald-50 border-2 border-emerald-100 rounded-2xl p-8 text-center shadow-xl animate-fade-in">
                        <div class="bg-emerald-100 w-20 h-20 mx-auto rounded-full flex items-center justify-center mb-4">
                            <span class="text-4xl">âœ…</span>
                        </div>
                        <h3 class="font-black text-2xl text-emerald-800 mb-2">×”×›×œ ×ª×§×™×Ÿ!</h3>
                        <p class="text-emerald-700 text-lg mb-4">
                            ×œ× × ××¦××• ×§×¨×™××•×ª ×©×™×¨×•×ª ×¤×ª×•×—×•×ª ×œ×¨×›×‘ ××¡×¤×¨ <strong class="font-mono">${input}</strong>.
                        </p>
                        <p class="text-xs text-emerald-600/60">
                            * ×”× ×ª×•× ×™× × ×›×•× ×™× ×œ××•×¢×“ ×¢×“×›×•×Ÿ ×”×××’×¨ ×”××—×¨×•×Ÿ. ×˜.×œ.×—
                        </p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
